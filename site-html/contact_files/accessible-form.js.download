(()=>{document.addEventListener("DOMContentLoaded",()=>{n()});const{__:e,_n:t}=wp.i18n,r={warning:e("Warning.","jetpack-forms"),invalidForm:e("Please make sure all fields are valid.","jetpack-forms"),checkboxMissingValue:e("Please select at least one option.","jetpack-forms"),invalidDate:e("The date is not valid.","jetpack-forms"),submittingForm:e("Submitting form","jetpack-forms"),genericError:e("Please correct this field","jetpack-forms"),errorCount:e=>t("You need to fix %d error.","You need to fix %d errors.",e,"jetpack-forms")},n=()=>{document.querySelectorAll(".wp-block-jetpack-contact-form-container form.contact-form").forEach(a)},a=e=>{e.hasAttribute("novalidate")||e.setAttribute("novalidate",!0);const t={hasInsetLabel:f(e)};let r={};const n=a=>{a.preventDefault(),i(e)||(q(e,r,t),o(e)?(r={},e.removeEventListener("submit",n),j(e)):r=$(e,t))};e.addEventListener("submit",n)},o=e=>{let t=e.checkValidity();if(!t)return!1;const r=b(e);for(const e of r)if(l(e)&&!m(e))return!1;const n=v(e);for(const e of n)if(!p(e))return!1;return t},i=e=>!0===e.getAttribute("data-submitting"),s=e=>"fieldset"===e.tagName.toLowerCase()&&e.classList.contains("grunion-checkbox-multiple-options"),c=e=>"fieldset"===e.tagName.toLowerCase()&&e.classList.contains("grunion-radio-options"),l=e=>e.hasAttribute("data-required"),d=e=>{return"input"===(t=e).tagName.toLowerCase()&&t.classList.contains("jp-contact-form-date")&&e.value?p(e):e.validity.valid;var t},u=e=>{const t=Array.from(e.querySelectorAll('input[type="radio"]'));return t.length>0&&t.every(e=>e.validity.valid)},m=e=>{if(!l(e))return!0;const t=Array.from(e.querySelectorAll('input[type="checkbox"]'));return t.length>0&&t.some(e=>e.checked)},p=e=>{const t=e.getAttribute("data-format"),n=e.value,a=window.jQuery;if(n&&t&&void 0!==a)try{a.datepicker.parseDate(t,n)}catch(t){return e.setCustomValidity(r.invalidDate),!1}return!0},f=e=>{const t=e.querySelector(".wp-block-jetpack-contact-form");if(!t)return!1;const r=t.classList;return r.contains("is-style-outlined")||r.contains("is-style-animated")},h=e=>e.querySelector('[type="submit"]')||e.querySelector('button:not([type="reset"])'),b=e=>Array.from(e.querySelectorAll(".grunion-checkbox-multiple-options")),v=e=>Array.from(e.querySelectorAll("input.jp-contact-form-date")),y=e=>{const t=k((e=>Array.from(e.elements).filter(e=>!["hidden","submit"].includes(e.type)&&null!==e.offsetParent))(e)),r={simple:t.default,singleChoice:[],multipleChoice:[]},n=t.radios.reduce((e,t)=>e.includes(t.name)?e:[...e,t.name],[]);for(const t of n){const n=e.querySelector(`input[type="radio"][name="${t}"]`);if(n){const e=n.closest("fieldset");e&&r.singleChoice.push(e)}}const a=t.checkboxes.reduce((e,t)=>e.includes(t.name)?e:[...e,t.name],[]);for(const t of a){const n=e.querySelector(`input[type="checkbox"][name="${t}"]`);if(n){const e=n.closest("fieldset");e&&r.multipleChoice.push(e)}}return r},g=e=>e.querySelector(".contact-form__error"),A=e=>e.querySelectorAll("[aria-invalid]"),C=e=>{const t=document.createDocumentFragment();return t.appendChild((()=>{const e=document.createElement("span"),t=document.createElement("span"),n=document.createElement("i");return t.textContent=r.warning,t.classList.add("visually-hidden"),n.setAttribute("aria-hidden",!0),e.classList.add("contact-form__warning-icon"),e.appendChild(t),e.appendChild(n),e})()),t.appendChild((e=>{const t=document.createElement("span");return t.textContent=e,t})(e)),t},L=e=>{const t=document.createElement("div");return t.id=e,t.classList.add("contact-form__input-error"),t},k=e=>e.reduce((e,t)=>{switch(t.type){case"radio":e.radios.push(t);break;case"checkbox":t.name.indexOf("[]")===t.name.length-2?e.checkboxes.push(t):e.default.push(t);break;default:e.default.push(t)}return e},{default:[],radios:[],checkboxes:[]}),q=(e,t,r)=>{E(e,r);for(const r in t)e.querySelectorAll(`[name="${r}"]`).forEach(e=>e.removeEventListener(t[r][0],t[r][1]))},E=(e,t)=>{S(e),w(e,t)},S=e=>{const t=g(e);t&&t.replaceChildren()},w=(e,t)=>{for(const r of A(e))c(r)||s(r)?x(r):_(r,t)},x=e=>{e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");const t=e.querySelector(".contact-form__input-error");t&&t.replaceChildren()},_=(e,t)=>{e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby");const r=e.closest(t.hasInsetLabel?".contact-form__inset-label-wrap":".grunion-field-wrap");if(!r)return;const n=r.querySelector(".contact-form__input-error");n&&n.replaceChildren()},j=e=>{M(e),e.setAttribute("data-submitting",!0),e.submit()},M=e=>{const t=h(e);t&&(t.setAttribute("aria-disabled",!0),t.appendChild((()=>{const e=document.createElement("span"),t=document.createElement("span"),n=document.createElement("span");return t.setAttribute("aria-hidden",!0),t.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"><animateTransform attributeName="transform" type="rotate" dur="0.75s" values="0 12 12;360 12 12" repeatCount="indefinite"/></path></svg>',n.classList.add("visually-hidden"),n.textContent=r.submittingForm,e.classList.add("contact-form__spinner"),e.appendChild(t),e.appendChild(n),e})()))},$=(e,t)=>(T(e,t),D(e,t)),D=(e,t)=>{let r={};const n=()=>I(e);for(const o of A(e)){let i;i=c(o)&&(a=o,Array.from(a.querySelectorAll('input[type="radio"]')).some(e=>e.hasAttribute("required")||e.hasAttribute("aria-required")))?F(o,n,e,t):s(o)&&l(o)?N(o,n,e,t):P(o,n,e,t),r={...r,...i}}var a;return r},F=(e,t,r,n)=>{const a={},o=()=>{u(e)?x(e):O(e,r,n),t()},i=e.querySelectorAll('input[type="radio"]');for(const e of i)e.addEventListener("blur",o),e.addEventListener("change",o),a[e.name]=["blur",o],a[e.name]=["change",o];return a},N=(e,t,r,n)=>{const a={},o=()=>{m(e)?x(e):R(e,r,n),t()},i=e.querySelectorAll('input[type="checkbox"]');for(const e of i)e.addEventListener("blur",o),e.addEventListener("change",o),a[e.name]=["blur",o],a[e.name]=["change",o];return a},P=(e,t,r,n)=>{const a=e.validity.valueMissing,o={},i=()=>{d(e)?_(e,n):B(e,r,n),t()},s=()=>{e.validity.valueMissing?B(e,r,n):_(e,n),t()};return e.addEventListener("blur",i),o[e.name]=["blur",i],a&&(e.addEventListener("input",s),o[e.name]=["input",s]),o},T=(e,t)=>{const r=Z(e,t);V(e,r)},V=(e,t,n={})=>{let a=g(e);if(!a){a=(()=>{const e=document.createElement("div");return e.classList.add("contact-form__error"),e})();const t=h(e);t?t.parentNode.insertBefore(a,t):e.appendChild(a)}const{disableLiveRegion:o}=n;o?(a.removeAttribute("aria-live"),a.removeAttribute("role")):(a.setAttribute("aria-live","assertive"),a.setAttribute("role","alert"));const i=t.length,l=[r.invalidForm];i>0&&l.push(r.errorCount(i).replace("%d",i)),a.appendChild(C(l.join(" "))),i>0&&a.appendChild(((e,t)=>{const r=document.createElement("ul");for(const n of t){const t=n.id;if(!t)continue;let a;if(a=s(n)||c(n)?n.querySelector("legend"):e.querySelector(`label[for="${t}"]`),!a)continue;const o=document.createElement("li"),i=document.createElement("a");i.textContent=a.innerText,i.setAttribute("href",`#${t}`),o.appendChild(i),r.appendChild(o)}return r})(e,t))},I=e=>{S(e),o(e)||V(e,A(e),{disableLiveRegion:!0})},Z=(e,t)=>{const r=[],{simple:n,singleChoice:a,multipleChoice:o}=y(e);for(const a of n)d(a)||(B(a,e,t),r.push(a));for(const n of a)u(n)||(O(n,e,t),r.push(n));for(const n of o)m(n)||(R(n,e,t),r.push(n));return r},B=(e,t,r)=>{const n=`${e.name}-error`;let a=t.querySelector(`#${n}`);if(!a){a=L(n);const t=e.closest(r.hasInsetLabel?".contact-form__inset-label-wrap":".grunion-field-wrap");t&&t.appendChild(a)}a.replaceChildren(C(e.validationMessage)),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",n)},O=(e,t,r)=>{Y(e,t,r)},R=(e,t,n)=>{Y(e,t,{...n,message:r.checkboxMissingValue})},Y=(e,t,n)=>{const a=e.querySelector("input");if(!a)return;const o=`${a.name.replace("[]","")}-error`;let i=t.querySelector(`#${o}`);i||(i=L(o)),i.replaceChildren(C(a.validationMessage||n.message||r.genericError)),e.appendChild(i),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",o)}})();